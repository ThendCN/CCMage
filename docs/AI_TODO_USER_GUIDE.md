# AI 增强 Todo 功能 - 用户指南

## 🎯 功能概述

CCMage v1.2.0 引入了强大的 AI 增强 Todo 功能，让任务管理更智能、更高效！

### 三大核心功能

| 功能 | 描述 | 图标 |
|------|------|------|
| **AI 智能拆分** | 一句话描述，AI 自动拆分为多个子任务 | ✨ Sparkles |
| **AI 协作助手** | 为任务开启专属 AI 对话，提供技术建议 | 🤖 Bot |
| **AI 任务验证** | 自动验证任务完成质量（即将推出） | ✅ Check |

---

## 📖 使用指南

### 功能 1：AI 智能拆分任务

**适用场景：** 创建复杂任务时，不确定如何拆分子任务

**使用步骤：**

1. **打开任务管理**
   - 在项目卡片上点击"任务"按钮
   - 进入任务管理界面

2. **点击"新建任务"**
   - 点击界面右上角的"新建任务"按钮
   - 弹出创建任务对话框

3. **填写任务信息**
   ```
   标题：实现用户登录功能
   描述：支持邮箱和手机号登录，需要密码加密和会话管理
   ```

4. **启用 AI 智能拆分**
   - 勾选"✨ 使用 AI 智能拆分任务"复选框
   - 查看提示：AI 将自动拆分为 3-8 个子任务

5. **点击"AI 智能拆分并创建"**
   - AI 开始分析任务（约 3-5 秒）
   - 自动创建主任务和所有子任务
   - 刷新列表查看结果

**AI 会生成什么？**

```
主任务：实现用户登录功能
├── 子任务 1: 设计数据库表结构 (2h, high)
├── 子任务 2: 实现密码加密服务 (1.5h, medium)
├── 子任务 3: 开发登录 API 接口 (3h, high)
├── 子任务 4: 实现会话管理 (2h, medium)
├── 子任务 5: 前端登录表单 (2.5h, medium)
└── 子任务 6: 编写单元测试 (1.5h, low)
```

**优势：**
- ✅ 自动估算工时
- ✅ 设置合理的优先级
- ✅ 按执行顺序排列
- ✅ 详细的任务描述

---

### 功能 2：AI 协作助手

**适用场景：** 执行任务时遇到技术问题，需要 AI 帮助

**使用步骤：**

1. **找到需要协助的任务**
   - 在任务列表中找到目标任务

2. **点击任务右侧的 AI 按钮**
   - 紫色的 🤖 Bot 图标
   - 会打开 AI 对话界面

3. **AI 自动了解任务上下文**

   AI 已经知道：
   - ✅ 任务标题和描述
   - ✅ 任务类型和优先级
   - ✅ 所有子任务列表
   - ✅ 之前的验证结果

4. **直接提问**

   示例问题：
   ```
   - "这个登录功能应该怎么实现？"
   - "如何安全地存储密码？"
   - "session 和 JWT 哪个更合适？"
   - "帮我写一下登录 API 的代码"
   ```

5. **AI 提供针对性建议**

   AI 会结合任务上下文给出：
   - 技术方案建议
   - 代码实现示例
   - 最佳实践提醒
   - 潜在问题预警

6. **继续对话**
   - 可以追问细节
   - 要求修改代码
   - 讨论替代方案
   - 所有对话都会保存

**对话示例：**

```
你: 这个登录功能怎么实现？

AI: 根据你的任务"实现用户登录功能"，我建议以下方案：

【数据库设计】
1. users 表需要字段：
   - id (主键)
   - email (唯一索引)
   - phone (唯一索引)
   - password_hash (bcrypt)
   - created_at

【后端实现】
使用 bcrypt 加密密码，JWT 管理会话：

```javascript
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');

async function login(emailOrPhone, password) {
  // 1. 查找用户
  const user = await findUser(emailOrPhone);

  // 2. 验证密码
  const valid = await bcrypt.compare(password, user.password_hash);

  // 3. 生成 token
  const token = jwt.sign({ userId: user.id }, SECRET, { expiresIn: '7d' });

  return { token, user };
}
```

根据你的子任务 2"实现密码加密服务"，我已经包含了 bcrypt。
需要我详细解释某个部分吗？
```

**优势：**
- 🎯 **上下文感知**：AI 已经了解任务详情，无需重复解释
- 💬 **连续对话**：可以深入讨论，追问细节
- 📝 **历史记录**：所有对话保存，方便回顾
- 🔄 **跨引擎支持**：可切换 Claude Code / Codex

---

### 功能 3：查看 AI 协作历史

**步骤：**

1. 打开项目的 AI 对话界面
2. 点击"历史记录"按钮
3. 查看所有相关对话
4. 点击历史记录可重新加载

---

## 🎨 界面说明

### 任务卡片增强

```
┌─────────────────────────────────────────────┐
│ [○] 📋 实现用户登录功能         [high]     │
│                                             │
│ 支持邮箱和手机号登录，需要密码加密           │
│                                             │
│ 📅 2025-12-01  预估: 3h  实际: 1.5h         │
│                                             │
│                              [🤖] [🗑️]      │  ← AI 按钮
└─────────────────────────────────────────────┘
```

### 创建任务对话框增强

```
┌─────────────────────────────────────────────┐
│ 新建任务                                 [X] │
├─────────────────────────────────────────────┤
│                                             │
│ 标题: [实现用户登录功能              ]     │
│                                             │
│ 描述: [支持邮箱和手机号登录...        ]     │
│                                             │
│ 优先级: [高▼]  类型: [功能▼]  工时: [3  ]  │
│                                             │
│ 截止日期: [2025-12-01    ]                  │
│                                             │
│ ┌───────────────────────────────────────┐  │
│ │ [✓] ✨ 使用 AI 智能拆分任务           │  │ ← AI 拆分选项
│ │                                       │  │
│ │ AI 将根据任务描述自动拆分为 3-8 个    │  │
│ │ 子任务，包含标题、描述、工时估算和     │  │
│ │ 优先级。                              │  │
│ └───────────────────────────────────────┘  │
│                                             │
│       [✨ AI 智能拆分并创建]    [取消]       │  ← 紫色按钮
└─────────────────────────────────────────────┘
```

---

## 🔧 技术细节

### AI 上下文注入机制

当你为任务开启 AI 协作时，系统会自动注入以下上下文：

```
【当前任务上下文】
- 任务标题: 实现用户登录功能
- 任务描述: 支持邮箱和手机号登录
- 任务类型: feature
- 优先级: high
- 状态: in_progress
- 预估工时: 3小时
- 实际工时: 1.5小时

【子任务列表】
1. [completed] 设计数据库表结构
2. [in_progress] 实现密码加密服务
3. [pending] 开发登录 API 接口
4. [pending] 实现会话管理
5. [pending] 前端登录表单

【最近验证结果】
- 结果: partial
- 置信度: 75%
- 发现的问题: 密码强度校验缺失

【用户请求】
这个登录功能怎么实现？
```

AI 看到的是完整上下文，因此能提供更精准的建议！

### 会话关联机制

- 每次 AI 对话都会关联到任务
- 可通过 API 查询任务的所有 AI 会话
- 会话记录包含：时间、内容、结果

---

## 💡 最佳实践

### ✅ DO - 推荐做法

1. **任务描述要详细**
   ```
   ✅ 好：实现用户登录功能，支持邮箱和手机号登录，使用 JWT 管理会话
   ❌ 差：实现登录
   ```

2. **善用 AI 拆分**
   - 复杂任务（预估 > 5h）使用 AI 拆分
   - 检查拆分结果，必要时手动调整

3. **在合适的时机使用 AI 协作**
   - 设计阶段：方案选型、架构建议
   - 实现阶段：代码示例、调试帮助
   - 测试阶段：测试用例建议

4. **保持对话连贯**
   - 在同一个对话中追问细节
   - 不需要每次都重新解释任务

### ❌ DON'T - 避免的做法

1. **不要过度依赖 AI**
   - AI 是辅助工具，不能替代思考
   - 关键决策仍需人工评审

2. **不要忽略拆分结果**
   - AI 拆分后检查合理性
   - 根据实际情况调整优先级和工时

3. **不要在简单任务上使用 AI**
   - "修改按钮颜色"这类任务不需要 AI
   - 节省 AI 额度用在刀刃上

---

## 🔄 工作流程建议

### 完整的 AI 增强工作流

```
1. 📋 需求分析
   ↓ 使用一句话描述任务

2. ✨ AI 智能拆分
   ↓ AI 自动拆分为子任务

3. ✏️ 人工调整
   ↓ 检查拆分结果，调整细节

4. 🎯 执行任务
   ↓ 按子任务逐个执行

5. 🤖 AI 协作
   ↓ 遇到问题时打开 AI 助手

6. ✅ 标记完成
   ↓ 完成后标记状态

7. 🔍 AI 验证（即将推出）
   ↓ 自动验证任务质量
```

---

## 📊 数据隐私说明

### 数据存储

- ✅ 所有 AI 对话历史都保存在本地数据库
- ✅ 会话记录可随时查看和删除
- ✅ 仅在用户主动操作时调用 AI API

### 数据传输

- 传输到 AI 的内容：
  - 任务标题、描述
  - 子任务列表
  - 用户输入的问题

- **不会传输：**
  - ❌ 项目源代码（除非用户明确要求）
  - ❌ 敏感配置信息
  - ❌ 其他项目的数据

---

## ⚙️ API 密钥配置

### 配置 Anthropic API Key

1. 编辑 `.env` 文件
```env
ANTHROPIC_API_KEY=sk-ant-xxx
ANTHROPIC_BASE_URL=https://api.husanai.com  # 可选
```

2. 重启后端服务
```bash
npm run dev:backend
```

3. 验证配置
- 打开任何项目
- 点击 AI 按钮
- 如果能正常对话，说明配置成功

---

## ❓ 常见问题

### Q1: AI 拆分的任务不满意怎么办？
**A:** AI 拆分只是建议，你可以：
- 创建后手动编辑子任务
- 删除不需要的子任务
- 添加 AI 遗漏的子任务
- 或者直接使用普通创建方式

### Q2: AI 协作按钮点击后没反应？
**A:** 检查：
1. `.env` 文件中的 API Key 是否配置
2. 后端日志是否有错误
3. 网络连接是否正常

### Q3: 一个任务可以开启多次 AI 协作吗？
**A:** 可以！每次对话都会被记录，你可以：
- 多次打开同一个任务的 AI 对话
- 所有历史对话都会保存
- 在历史记录中查看之前的对话

### Q4: AI 拆分需要多长时间？
**A:** 通常 3-5 秒，取决于：
- 任务描述的复杂度
- API 响应速度
- 网络状况

### Q5: 可以修改 AI 拆分的设置吗？
**A:** 当前版本使用固定设置：
- 子任务数量: 3-8 个
- 包含字段: 标题、描述、工时、优先级、顺序
- 未来版本会支持自定义

---

## 🎓 视频教程（即将推出）

敬请期待我们的视频教程系列：
- [ ] AI 智能拆分任务演示
- [ ] AI 协作助手实战案例
- [ ] 高级技巧和最佳实践

---

## 📮 反馈与支持

遇到问题或有建议？欢迎联系我们：
- GitHub Issues: [项目地址]
- 邮箱: [支持邮箱]

---

**版本：** v1.2.0
**最后更新：** 2025-11-29
**作者：** CCMage 团队
